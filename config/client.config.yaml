# Shepherd Client 配置文件
# Client 模式：作为工作节点连接到 Master
# 使用新的统一配置格式

# 运行模式
mode: client

# 节点配置
node:
  # 节点ID，auto 表示自动生成
  id: auto
  # 节点名称，空表示使用主机名
  name: client-1
  # 节点角色：client
  role: client
  
  # Client 角色配置
  client_role:
    enabled: true
    # Master 服务器地址
    master_address: http://192.168.10.1:9190
    # 注册重试次数
    register_retry: 3
    # 心跳间隔（秒）
    heartbeat_interval: 30
    # 心跳超时（秒）
    heartbeat_timeout: 15
  
  # 资源监控配置
  resources:
    monitor_interval: 5
    report_gpu: true
  
  # 命令执行器配置
  executor:
    max_concurrent: 4
    allowed_commands:
      - load_model
      - unload_model
      - run_llamacpp

# 服务器配置
server:
  # Client 监听端口（应与 Master 不同，如 Master 用 9190，Client 用 9191）
  web_port: 9191
  anthropic_port: 9170
  ollama_port: 11434
  lmstudio_port: 1234
  host: 0.0.0.0
  read_timeout: 60
  write_timeout: 60

# 模型配置
model:
  paths:
    - ./models
    - ~/.cache/huggingface/hub
  auto_scan: true
  scan_interval: 0

# llama.cpp 配置
llamacpp:
  paths:
    - path: ./llama.cpp
      name: Default

# 下载配置
download:
  directory: ./downloads
  max_concurrent: 4
  chunk_size: 1048576
  retry_count: 3
  timeout: 300

# 安全配置
security:
  api_key_enabled: false
  api_key: ""
  cors_enabled: true
  allowed_origins:
    - "*"

# 兼容性配置
compatibility:
  ollama:
    enabled: true
    port: 11434
  lmstudio:
    enabled: false
    port: 1234

# 日志配置
log:
  level: info
  format: json
  output: both
  directory: ./logs
  max_size: 100
  max_backups: 3
  max_age: 7
  compress: true

# 存储配置
storage:
  type: sqlite
  sqlite:
    path: ./data/shepherd.db
    enable_wal: true

# Client 兼容配置（旧格式兼容）
client:
  enabled: true
  master_address: http://192.168.10.1:9190
  client_info:
    id: ""
    name: client-1
    tags:
      - gpu
      - rocm
    metadata:
      os: linux
      arch: amd64
      description: AMD GPU Worker
  heartbeat:
    interval: 30
    timeout: 90
  conda_env:
    enabled: false
    conda_path: ""
    environments:
      shepherd: ""
  register_retry: 3
  heartbeat_interval: 5
  heartbeat_timeout: 15

# Master 兼容配置（Client 模式下不生效，但保留结构）
master:
  enabled: false
  network_scan:
    enabled: false
    subnets:
      - 192.168.1.0/24
      - 10.0.0.0/8
    port_range: 9191-9200
    timeout: 5
    auto_discover: false
    interval: 0

# Conda 环境配置（用于 Python 任务）
conda:
  default_env: shepherd
  available_envs:
    - shepherd
    - base
  conda_path: ""

# 资源限制
resources:
  max_concurrent_tasks: 1
  memory_limit: 0
  gpu_utilization_limit: 95
